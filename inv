plugin: azure.azcollection.azure_rm

cloud_environment: AzureUSGovernment
auth_source: cli

hostvar_expressions:
  ansible_host: private_ipv4_addresses | first

# GitHub Enterprise gets its own group only
conditional_groups:
  github_enterprise_servers: |
    (image.publisher is defined and image.publisher == 'GitHub') or
    (tags.application is defined and tags.application == 'github-enterprise')
  
  # Linux hosts EXCEPT GitHub Enterprise
  os_linux: |
    os_profile.system == 'linux' and 
    not ((image.publisher is defined and image.publisher == 'GitHub') or 
         (tags.application is defined and tags.application == 'github-enterprise'))
  
  # Windows hosts (assuming no GHE on Windows)
  os_windows: os_profile.system == 'windows'
  
  # Location groups excluding GHE
  azure_loc_eastus: |
    location == 'eastus' and
    not ((image.publisher is defined and image.publisher == 'GitHub') or
         (tags.application is defined and tags.application == 'github-enterprise'))
  
  azure_loc_westus: |
    location == 'westus' and
    not ((image.publisher is defined and image.publisher == 'GitHub') or
         (tags.application is defined and tags.application == 'github-enterprise'))

include_vm_resource_groups:
  - '*'
