---
- name: Deploy Wiz Connector to AKS
  hosts: localhost
  connection: local
  vars:
    namespace: wiz-system
    jfrog_helm_repo: "https://your-company.jfrog.io/artifactory/helm-virtual"
    jfrog_username: "{{ lookup('env', 'JFROG_USER') }}"
    jfrog_password: "{{ lookup('env', 'JFROG_PASSWORD') }}"
    wiz_chart_version: "1.2.3"  # Pin your version
    
  tasks:
    - name: Add JFrog Helm repository
      kubernetes.core.helm_repository:
        name: jfrog-helm
        repo_url: "{{ jfrog_helm_repo }}"
        username: "{{ jfrog_username }}"
        password: "{{ jfrog_password }}"

    - name: Update Helm repo cache
      command: helm repo update

    # ... your other tasks (namespace, service account, etc) ...

    - name: Deploy Wiz Connector from JFrog
      kubernetes.core.helm:
        name: wiz-connector
        chart_ref: jfrog-helm/wiz-kubernetes-connector  # Reference the repo you added
        chart_version: "{{ wiz_chart_version }}"
        release_namespace: "{{ namespace }}"
        values_files:
          - /path/to/your/values.yaml
        values:
          serviceAccount:
            create: false
            name: wiz-connector
