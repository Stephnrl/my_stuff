---
# apps/wiz-connector/config.yml
# Wiz Kubernetes Connector - Medium complexity deployment

app_name: wiz-connector
namespace: wiz
deployment_type: complex

helm:
  chart: wiz-kubernetes-connector
  repo_name: wiz
  repo_url: https://charts.wiz.io
  version: "2.0.0"  # Update to actual version
  values_file: values.yml
  wait: true
  timeout: "10m"
  atomic: true

service_account:
  create: true
  name: wiz-connector-sa

csi_driver:
  enabled: true
  provider: azure-keyvault

# Pre-deployment: SA and secrets
pre_deploy_manifests:
  - "{{ role_path }}/templates/azure/service_account.yml.j2"
  - "{{ role_path }}/templates/azure/keyvault_csi_secret_provider.yml.j2"

# Azure configuration
azure:
  keyvault_name: "{{ lookup('env', 'AZURE_KEYVAULT_NAME') }}"
  tenant_id: "{{ lookup('env', 'AZURE_TENANT_ID') }}"
  managed_identity_client_id: "{{ lookup('env', 'AZURE_MANAGED_IDENTITY_CLIENT_ID') }}"
  resource_group: "{{ lookup('env', 'AZURE_RESOURCE_GROUP') }}"
  aks_cluster: "{{ lookup('env', 'AZURE_AKS_CLUSTER') }}"

# Wiz connector secrets from Key Vault
secrets:
  - name: wiz-connector-credentials
    keyvault_secret: wiz-client-id
    key: clientId
    sync_as_secret: true
  - name: wiz-connector-credentials
    keyvault_secret: wiz-client-secret
    key: clientSecret
    sync_as_secret: false

wait_for_resources: true
wait_timeout: 300

# Namespace labels for Wiz
namespace_labels:
  wiz.io/scan: "enabled"
